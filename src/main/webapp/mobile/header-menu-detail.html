
<!-- menu slider -->
<div id="menu-backscreen"></div>
<div id="menu-toggle">
	<div id='menu-contents'>
		<div id='menu-upper-btn'>
			<a href='/mobile/gmode/index.html'><img id='home-btn'
				src='/image/icon/mobile_icon/home_bt.png'></a> <img
				src='/image/icon/change.png'>
		</div>
		<br>
		<div id='login-btn' class='user-infobox'>
			<img class='user-img' src='/image/logo/header/login_01_w.png'>
			<p class='menu-login-text'>로그인</p>
		</div>
		<div id='mypage-btn' class='user-infobox'>
      <img  class='user-img' id='user-photo' src='/image/logo/header/login_01_w.png'> 
      <p class='menu-login-text'>프로필</p>
    </div>
		<div class='menu-category-btn menu-top-btn' id='myevent-btn'>나의이벤트</div>
		<hr class='menu-category-separator'>
		<div class='menu-category-btn' id="menu-category-musician-favor">관심뮤지션</div>
		<hr class='menu-category-separator'>
		<div class='menu-category-btn' id="menu-category-event-regist">이벤트 등록하기</div>
		<hr class='menu-category-separator'>
		<div class='menu-category-btn' id='go-musimode-btn'>뮤지션모드로 전환</div>
		<hr class='menu-category-separator'>
		<div class='menu-copyright'>
			<span id='menu-copyright-text'>@COPYRIGHT 2017</span> <img
				id='menu-copyright-img' src='/image/logo/ARMU_ch1.png'>
		</div>
		<!-- menu-copyright -->
	</div>
	<!-- menu-contents -->
</div>
<!-- menu-toggle -->
<!-- menu slider ended -->

<div id="search-backscreen"></div>
<div id="search-toggle">
  <div id='search-contents'>
  <i class="fa fa-angle-left" id="search-cancel" aria-hidden="true"></i>
  <form action="">
   <div id="search-container">
	   <i class="fa fa-search" id="search-icon" aria-hidden="true"></i>
	   <input type="search" id="search-text" placeholder="전공, 장르, 지역으로 뮤지션 검색" autofocus="autofocus">
	   <i class="fa fa-times-circle" id="search-text-delete" aria-hidden="true"></i>
   </div> 
   </form>
  <!-- search-header -->
  </div>
  
  <!-- search-contents -->
</div>
  <div id="search-result-container">
  </div>
<!-- search-toggle -->


<script id="search-result-template" type="text/x-handlebars-template">
{{#each listSearchResult}}
  <div class="search-list" data-no="{{no}}">
    <div class="search-list-img" style='background-image: url("{{photo}}_80.png")'></div>
    <div class="search-list-musi">
      <span>{{nickName}}</span>
      <div class="search-list-score">{{{score}}}</div>
    </div>
    <div class="search-list-hashtagbox">
      {{#each majorList}} <span>#{{this}}</span> {{/each}}
      {{#each genreList}} <span>#{{this}}</span> {{/each}}
      {{#each themeList}} <span>#{{this}}</span> {{/each}}
    </div>
  </div>
{{/each}}
</script>
<script>


  /*메뉴 관련*/
  var container = $("#container"), menuBtn = $('#header-menu-menu'), menuBackscreen = $("#menu-backscreen"), menuToggle = $("#menu-toggle"), musicianFavor = $("#menu-category-musician-favor"), eventRegist = $("#menu-category-event-regist"), headerMenuSearch = $("#header-menu-search"), searchToggle = $("#search-toggle"), searchCancel = $('#search-cancel'), searchText = $('#search-text'), searchTextDelete = $('#search-text-delete'), searchBackScreen = $("#search-backscreen")

  menuBtn.on('click', function() {
    menuBackscreen.css('display', 'block');
    menuToggle.toggle("slide", 300);
    container.css('position', 'fixed').css('overflow', 'hidden');
  });

  menuBackscreen.on('click', function() {
    menuToggle.toggle("slide", 300);
    menuBackscreen.css('display', 'none');
    container.css('position', '').css('overflow', '');
  })

  headerMenuSearch.on('click', function() {
    searchToggle.toggle("slide", {
      direction : 'right'
    }, 300);
    searchBackScreen.css('display', 'block')
    $('#search-text').val('')
    $('#search-text').focus()
    container.css('position', 'fixed').css('overflow', 'hidden');
  })

  searchBackScreen.on('click', function() {
    searchToggle.toggle("slide", {
      direction : 'right'
    }, 300);
    $('.search-list').remove()
    searchBackScreen.css('display', 'none')
    container.css('position', '').css('overflow', '');
  })

  searchCancel.on('click', function() {
    searchToggle.toggle("slide", {
      direction : 'right'
    }, 300);
    $('.search-list').remove()
    searchBackScreen.css('display', 'none')
    container.css('position', '').css('overflow', '');
  })

  searchTextDelete.on('click', function() {
    searchText.val('')
  })

  eventRegist.on('click', function() {
    location.href = '/mobile/gmode/event/regist.html'
  })

  musicianFavor.on('click', function() {
    location.href = '/mobile/gmode/favor/index.html'
  })

  $('#login-btn').on('click', function() {
    location.href = '/mobile/join.html'
  })

  $('#myevent-btn').on('click', function() {
    location.href = '/mobile/gmode/event/list.html'
  })

  $('#go-musimode-btn').on('click', function() {

    $.getJSON('/auth/checkMusi.json', function(result) {
      if (result.data == "musician") {
        location.href = '/mobile/musimode/index.html'
      }

      if (result.data == 'member') {
        swal({
          title : "뮤지션회원이 아닙니다 \n\n" + "뮤지션으로 가입하시겠어요?",
          type : "warning",
          showCancelButton : true,
          confirmButtonColor : "#8069ef",
          confirmButtonText : "네",
          closeOnConfirm : false,
          cancelButtonText : "아니요"
        }, function() {
          location.href = "/mobile/musi_signup.html"
        });
      }

    }, function(err) {
      console.log(err)
    })

  })

  $.getJSON('/auth/userinfo.json', function(result) {
    if (result.status == "success") {
      $('#mypage-btn').css('display', 'inline-block').on('click', function() {
        location.href = '/mobile/mypage/mypage.html'
      })
      $('#user-photo').attr('src', result.data.photo + '_140.png')
      $('#login-btn').css('display', 'none')
    } else {
      $('#mypage-btn').css('display', 'none')
      $('#login-btn').css('display', 'inline-block')
    }
  }, function(err) {
    console.log(err)
  })

  /* 로그인 관련*/
  
  /*검색시작*/
  var searchText =$('#search-text')
  searchText.keyup(function() {
    console.log(searchText.val())
    $.getJSON('/musician/listSearchResult.json', {'search':searchText.val()}, function(result) {
      console.log(result)
      $('.search-list').remove()
      if(result.status != 'success') {
        console.error("getJSON() 실패: ", result.status)
        return;
      }
      
      
      $.each(result.data.listSearchResult, function(i, item) {
        var starInteger = parseInt(item.score),
        starRealNumber = item.score - starInteger;
        starAdd(starInteger, starRealNumber, item)
      });
      
      var templateFn = Handlebars.compile($('#search-result-template').text())
      var generatedHTML = templateFn(result.data)
      var container = $('#search-result-container')
      var html = container.html()
      container.html(html + generatedHTML)
      
      if(searchText.val() == ''){
        $('.search-list').remove()
      }
      
      $('.search-list').click(function(event) {
        event.preventDefault()
        location.href = '/mobile/gmode/musi-info/index.html?no=' + $(this).attr('data-no') 
      })
      
    }, function(err) {
      console.log(err)
    })
  })
  
  function starAdd(starInteger, starRealNumber, item) {
  item.score = "";

  for (var i = 1; i <= starInteger; i++) {
    item.score += "<i class='fa fa-star' aria-hidden='true'></i>"
  }

  if(starInteger >= 5) {
    return;
  }

  if(starRealNumber >= 0.8) {
    item.score += "<i class='fa fa-star' aria-hidden='true'></i>"
  } else if(starRealNumber <= 0.3) {
    item.score += "<i class='fa fa-star-o' aria-hidden='true'></i>"
  } else {
    item.score += "<i class='fa fa-star-half-o' aria-hidden='true'></i>"
  }

  if(starInteger < 4) {
    for (var i = 1; i <= 4 - starInteger; i++) {
      item.score += "<i class='fa fa-star-o' aria-hidden='true'></i>"
    }
  }

  return item;
}
  
  
/* 검색끝 */
</script>
<script src="/node_modules/handlebars/dist/handlebars.min.js"></script>