<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="bitcamp.java93.dao.ChatDao">
  
  <resultMap type="chat" id="chatMap">
    <id column="chatno" property="no"/>
    <result column="isread" property="isRead"/>
    <result column="date" property="date"/>
    <result column="msg" property="message"/>
    <result column="who" property="senderNo"/>
    <association property="musician" javaType='Musician'>
      <id property="no" column="musino"/>
    <result property="name" column="musiname"/>
    <result property="nickName" column="musinick"/>
    <result property="photo" column="musiphoto"/>
    </association>
    <association property="writer" javaType='Member'>
      <id property="no" column="gmno"/>
    <result property="name" column="gmname"/>
    <result property="photo" column="gmphoto"/>
    </association>
  </resultMap>


 <select id="selectChatList" resultMap="chatMap" parameterType="map">
  select chatno, isread, date, msg, c.muno, c.mno, who,
mu.mno as musino, mu.name as musiname, musi.nick as musinick, mu.path as musiphoto,
m.mno as gmno, m.name as gmname, m.path as gmphoto
from chat c
inner join memb mu on c.muno=mu.mno inner join musi on mu.mno=musi.muno
inner join memb m on c.mno=m.mno
where c.mno=5 and c.muno=1
order by date asc
  </select>
  
  <select id="selectMusiChatList" resultMap="chatMap" parameterType="map">
  select chatno, isread, date, msg, c.muno, c.mno, who,
mu.mno as musino, mu.name as musiname, musi.nick as musinick, mu.path as musiphoto,
m.mno as gmno, m.name as gmname, m.path as gmphoto
from chat c
inner join memb mu on c.muno=mu.mno inner join musi on mu.mno=musi.muno
inner join memb m on c.mno=m.mno
where c.mno=#{mno} and c.muno=#{muno}
order by date asc
  </select>
  
</mapper>










