<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="bitcamp.java93.dao.ChatDao">
  
  <resultMap type="chat" id="chatMap">
    <id column="chatno" property="no"/>
    <result column="isread" property="isRead"/>
    <result column="date" property="date"/>
    <result column="msg" property="message"/>
    <result column="who" property="senderNo"/>
    <association property="musician" javaType='Member'>
      <id property="no" column="musino"/>
    <result property="name" column="musiname"/>
    <result property="nickName" column="musinick"/>
    <result property="photo" column="musiphoto"/>
    </association>
    <association property="writer" javaType='Member'>
      <id property="no" column="gmno"/>
    <result property="name" column="gmname"/>
    <result property="nickName" column="gmnick"/>
    <result property="photo" column="gmphoto"/>
    </association>
  </resultMap>


 <select id="selectChatList" resultMap="chatMap" parameterType="int">
  select  notino, n.type, n.date, n.cont, n.eno, e.title, 
  gm.mno as gmno, gm.name as gmname, gm.path as gmphoto, 
  n.muno as musino, m.name as musiname, m.path as musiphoto
from noti n
inner join memb m on n.muno=m.mno
inner join evn e on n.eno=e.eno inner join memb gm on e.mno=gm.mno
where gm.mno=#{no}
order by date desc
  </select>
  
  <select id="selectMusiChatList" resultMap="chatMap" parameterType="int">
  select  notino, n.type, n.date, n.cont, n.eno, e.title, 
  gm.mno as gmno, gm.name as gmname, gm.path as gmphoto, 
  n.muno as musino, m.name as musiname, m.path as musiphoto
from noti n
inner join memb m on n.muno=m.mno
inner join evn e on n.eno=e.eno inner join memb gm on e.mno=gm.mno
where n.muno=#{no}
order by date desc
  </select>
  
</mapper>










