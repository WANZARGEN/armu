<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="bitcamp.java93.dao.NotificationDao">
  
  <resultMap type="notification" id="notificationMap">
    <id column="notino" property="no"/>
    <result column="type" property="type"/>
    <result column="date" property="date"/>
    <result column="cont" property="contents"/>
    <association property="musician" javaType='Musician'>
      <id property="no" column="musino"/>
    <result property="nickName" column="nick"/>
    <result property="photo" column="musiphoto"/>
    </association>
    <association property="writer" javaType='Member'>
      <id property="no" column="gmno"/>
    <result property="name" column="gmname"/>
    <result property="photo" column="gmphoto"/>
    </association>
    <association property="event" javaType='Event'>
      <id property="no" column="eno"/>
    <result property="title" column="title"/>
    </association>
  </resultMap>

 <select id="selectNotiList" resultMap="notificationMap" parameterType="int">
  select  notino, n.type, n.date, n.cont, n.eno, e.title, 
  gm.mno as gmno, gm.name as gmname, gm.path as gmphoto, 
  n.muno as musino, mu.nick, m.path as musiphoto
from noti n
inner join memb m on n.muno=m.mno inner join musi mu on m.mno=mu.muno
inner join evn e on n.eno=e.eno inner join memb gm on e.mno=gm.mno
where gm.mno=#{no} and (n.type='이벤트 지원' or n.type='요청 수락')
order by date desc
  </select><!-- 완진 -->
  
  <select id="selectMusiNotiList" resultMap="notificationMap" parameterType="int">
  select  notino, n.type, n.date, n.cont, n.eno, e.title, 
  gm.mno as gmno, gm.name as gmname, gm.path as gmphoto, 
  n.muno as musino, mu.nick, m.path as musiphoto
from noti n
inner join memb m on n.muno=m.mno inner join musi mu on m.mno=mu.muno
inner join evn e on n.eno=e.eno inner join memb gm on e.mno=gm.mno
where n.muno=#{no}
order by date desc
  </select><!-- 완진 -->
  
  <insert id="insertEventPrNoti" parameterType="map">
    insert into noti(muno, eno, type, date, cont, prno) 
    values(#{muNo}, #{eNo}, '참여요청', CURDATE(), '이벤트 홍보', #{prNo})
  </insert><!-- 승민 -->
  
  <insert id="insertEventAppyNoti" parameterType="map">
    insert into noti(muno, eno, type, date, cont, appyno) 
    values(#{muNo}, #{eNo}, '지원', CURDATE(), '이벤트 지원', #{appyno})
  </insert><!-- 승민 -->
  
  <insert id="insertEventAppyCancelNoti" parameterType="map">
    insert into noti(muno, eno, type, date, cont) 
    values(#{muNo}, #{eNo}, '지원 취소', CURDATE(), '이벤트 지원 취소')
  </insert><!-- 승민 -->
  
  
  <insert id="insertEventEditNoti" parameterType="map">
    insert into noti(muno, eno, type, date, cont) 
    values(#{appyNo}, #{eNo}, '이벤트 수정', CURDATE(), '이벤트 수정')
  </insert><!-- 승민 -->
  
  <insert id="insertEventDeleteNoti" parameterType="map">
    insert into noti(muno, eno, type, date, cont) 
    values(#{appyNo}, #{eNo}, '이벤트 삭제', CURDATE(), '이벤트 삭제')
  </insert><!-- 승민 -->
  
  
</mapper>












