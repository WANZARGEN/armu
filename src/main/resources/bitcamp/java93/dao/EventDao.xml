<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="bitcamp.java93.dao.EventDao">

	<resultMap type="event" id="eventMap">
		<id column="eno" property="no" />
    <result column="eno" property="no" />
		<result column="title" property="title" />
		<result column="gno" property="memberNo" />
		<result column="theme" property="theme" />
		<result column="major" property="major" />
		<result column="genre" property="genre" />
		<result column="location" property="location" />
		<result column="pay" property="pay" />
		<result column="ddt" property="dueDate" />
		<result column="req" property="requirement" />
		<result column="song" property="song" />
		<result column="dpay" property="downPay" />
		<result column="date" property="date" />
		<association property="musician" column="name" resultMap="musicianMap2">
		</association>
		  <!-- <collection property="applicantList" ofType="Musician" resultMap="musicianMap" /> --> 
	</resultMap>

  <resultMap type="musician" id="musicianMap2">
    <id column="mno" property="no" />
    <result column="name" property="name" />
    <result column="path" property="photo" />
    <collection property="majorList" ofType="string"> 
        <result column="major2"/> 
    </collection>
    <collection property="genreList" ofType="string"> 
        <result column="genre2"/> 
    </collection> 
    <collection property="themeList" ofType="string"> 
       <result column="theme2"/> 
    </collection>
  </resultMap>
  
  
	<sql id="selectBasic">
  select eno, title, t.name as theme, mj.name as major, g.name as genre, l.name as location, pay, ddt, date
  from evn e inner join thm t on e.thmno=t.thmno
  inner join mjr mj on e.mjrno=mj.mjrno
  inner join gnr g on e.gnrno=g.gnrno
  inner join loc l on e.locno=l.locno
	</sql>
	
	<sql id="selectEventAppliedByMusician">
  select e.eno, title, t.name as theme, mj.name as major, g.name as genre, 
             l.name as location, e.pay, ddt, date, m.mno, m.name
  from evn e inner join thm t on e.thmno=t.thmno
  inner join mjr mj on e.mjrno=mj.mjrno
  inner join gnr g on e.gnrno=g.gnrno
  inner join loc l on e.locno=l.locno
  left outer join evn_appy ea on e.eno=ea.eno
  left outer join memb m on ea.muno=m.mno
  </sql>
  
  <sql id="selectOngoing">
  select e.eno, title, t.name as theme, mj.name as major, g.name as genre, 
             l.name as location, e.pay, ddt, date, m.mno, m.name, mu.path as path,
             mj2.name as major2, g2.name as genre2, t2.name as theme2
  from evn e inner join thm t on e.thmno=t.thmno
  inner join mjr mj on e.mjrno=mj.mjrno
  inner join gnr g on e.gnrno=g.gnrno
  inner join loc l on e.locno=l.locno
  inner join mtc mt on  e.eno=mt.eno
  inner join memb m on mt.muno=m.mno
  inner join musi mu on m.mno=mu.muno
  left outer join mjr_musi mjm on mu.muno=mjm.muno left outer join mjr mj2 on mjm.mjrno=mj2.mjrno
  left outer join gnr_musi gm on mu.muno=gm.muno left outer join gnr g2 on gm.gnrno=g2.gnrno
  left outer join thm_musi tm on mu.muno=tm.muno left outer join thm t2 on tm.thmno=t2.thmno
  </sql>


 

	<select id="selectOngoingList" resultMap="eventMap, musicianMap2">
		<include refid="selectOngoing" />
		order by title asc
	</select>

	
</mapper>












